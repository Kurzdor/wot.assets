(def macro ButVehicleToggleSlotStlyes()
    (style
        (height = "BUTTON_SIZE_MEDIUM['height']")
    )
    (scope
        (var hoverSource:str = "R.atlases.components.pic_grey_shine_hover()")
        (bind hoverSource 
            "isSelected ? 
                R.atlases.components.pic_red_shine_hover() : 
                R.atlases.components.pic_grey_shine_hover()" init=false
        )
    )

    (disableOverlay source='bitmap:SlotDisableBmp' padding=1px)

    (background source="R.atlases.components.button_slot_normal()" scale9grid="Rect(15, 15, 290, 5)" offsets="[-11, -11, -11, -11]")
 
    (bindcall hover source="hoverSource" scale9grid="Rect(15, 15, 18, 18)" blend='add' offsets="[1, 1, 1, 1]" wath=true init=true)

    (toggleIndicator source="R.atlases.components.button_slot_active()"
        scale9grid="Rect(15, 15, 290, 5)" 
        offsets=[-11px, -11px, -11px, -11px]
    )
    
    (toggleIcon
        sourceToggleOn="R.atlases.store.icon_tree_selected_093()"
        sourceToggleOff=null
        scale9grid=null
        offsets="[auto,auto,auto,-15, 0, auto]"
    )

    (down source="R.atlases.components.indicator_down()" scale9grid="BUTTON_BACKGROUND_RECT" offsets=null)
    (setFocusImage source="R.atlases.components.indicator_focus()" scale9grid="Rect(15, 7, 135, 5)" offsets=null)

    (soundDown = "R.sounds.play()")       # sound for 'down' state
    (soundOver = "R.sounds.highlight()")  # sound fo 'hover' state
    (toggle = true)
)

(def element AdditionalEquipmentSlot(name:str) layout=true
    (macro AdditionalEquipmentSlotModel)
    (scope
        (event onSlotSelectChange)
        (event playSlotAnim)
        (event onEnabledChange)

        (var icon:str = '')
        (var descr:str = '')
        (var isAlert:bool = false)
        (var tooltip:number = 0)
        (bind isSelected "$event.value" init=false (event "onSelectedChange"))
        (var isEnabledForTutorial:bool = true)
        (var isSlotAnimPlaying:bool = false)

        (dispatch playSlotAnim (bind enabled "isSlotAnimPlaying"))
        (dispatch onEnabledChange (bind enabled "!isEnabled"))

        (dispatch onSlotSelectChange on='onSelectedChange')
    )
    (style
        (flow = "Flow.HORIZONTAL")
    )

    (bind tabChildren "isEnabled")


    (element DrawBoundRect  1 1 58 58 0xff0000 2 0 false
        (style
            (position = "absolute")
        )
        (alpha = 0)
        (bind alpha "0" (event "onSlotSelectChange") (bind enabled "$event.value" init=false))
        (bind isSlotAnimPlaying false init=false (event "onSlotSelectChange") (bind enabled "$event.value" init=false))
        (bind alpha "0" (event "onEnabledChange") (bind enabled "$event.value" init=false))
        (bind isSlotAnimPlaying false init=false (event "onEnabledChange") (bind enabled "$event.value" init=false))
        (mouseChildren = false)
        (mouseEnabled = false)
        (controller $Animation
            (bindcall stop (event "onSlotSelectChange"))
            (bindcall stop (event "onEnabledChange"))
            (bindcall playSeq "[
                    {duration:0.5, from: {alpha:0.7}, to: {alpha:0}},
                    {duration:0.5, from: {alpha:0}, to: {alpha:0.7}}
                ]" repeatCount=-1
                (event "playSlotAnim")
            )
        )
    )

    (button 'slotButton'
        (macro ButVehicleToggleSlotStlyes)

        (style
            (width = 60px)
            (height = 60px)
        )

        (image
            (style
                (position="absolute")
                (bottom=-7px)
                (hcenter=0)
            )
            (bind visible "isAlert && isEnabled && isEnabledForTutorial")
            (source = "R.atlases.components.alertIcon()")
        )
        (tabIndex = 1)

        (bind icon "icon")
        (bind selected "isSelected")
        (bind enabled "isEnabled && isEnabledForTutorial")

        (dispatch onSelectedChange args="{value:$event.selected}" on='selectedChanged')

        (controller $ToolTip
            (args
                header="R.strings.tooltips.contentBuyView.slotCheckbox.notEnoughSlots.header.resId"
                body="R.strings.tooltips.contentBuyView.slotCheckbox.notEnoughSlots.body.resId"
            )
            (content = "R.views.common.tooltip_window.simple_tooltip_content.SimpleTooltipContent.resId")
            (decorator = "R.views.common.tooltip_window.tooltip_window.TooltipWindow.resId")
            (bind enabled "isAlert && isEnabled && isEnabledForTutorial")
        )

        (controller $ToolTip
            (bindcall args
                body="tooltip"
            )
            (content = "R.views.common.tooltip_window.simple_tooltip_content.SimpleTooltipContent.resId")
            (decorator = "R.views.common.tooltip_window.tooltip_window.TooltipWindow.resId")
            (bind enabled "isDisabledTooltip  && !(isEnabled  && isEnabledForTutorial)")
        )
    )

    (block
        (tabChildren = false)
        (tabEnabled = false)
        (style
            (height=100%)
            (paddingTop=9)
            (paddingLeft=13)
        )
        (tf
            (class MainTextStyle)
            (selectable = false)
            (bind text "descr")
        )
        (element Group 'actionPrices' 'group' renderer_name='ActionPriceSmall')
    )
)
