(def constant CHECKBOX_MAX_TOP_MARGIN 40)
(def constant CHECKBOX_MIN_TOP_MARGIN 24)
(def constant VEH_ICON_ELITE_MARGIN -13)
(def constant VEH_ICON_MARGIN -26)

(def css BuyVehicleViewVehicleNameStyle()
    (fontFamily = $TitleFont)
    (fontSize = 36)
    (textColor = 0xcbac77)
    (letterSpacing = 2)
)

(def element BuyVehicleView(preloadSwf:array=['./ub_congrats.swf']) layout = true isReadyTracked=true entrance=true loadOrder="LoadOrder.NOT_WAITING_FIRST"
    (macro BuyVehicleViewModel)
    (scope
        (event loadComplete)
        (event onImageBgLoaded)
        (bind isWithoutCommander "$event.selected" init=false on='onCheckboxWithoutCrewChanged')
        (var checkBoxTopMargin:number = 0)
        (bind checkBoxTopMargin "CHECKBOX_MIN_TOP_MARGIN +(CHECKBOX_MAX_TOP_MARGIN - CHECKBOX_MIN_TOP_MARGIN)*((viewSize.height-768)/256)" (event "viewResized"))
        (event onContentFadeOutComplete)
        (var swfLoaded:bool = false)
        (bind swfLoaded true init=false (event "loadComplete"))
    )
    (dispatch onCloseBtnClick on='escPressed')
    (style
        (bind width "viewSize.width" (event "viewResized"))
        (bind height "viewSize.height" (event "viewResized"))
        (align = "center|middle")
    )
    (name = 'BuyVehicleView')
    (controller $Tutorial viewTutorialId='BuyVehicleView')
    (bind visible "true" (event "onImageBgLoaded"))
    (image
        (style
            (position="absolute")
            (bind width "viewSize.width" (event "viewResized"))
            (bind height "viewSize.height" (event "viewResized"))
        )
        (bind source "bgSource")
        (dispatch onImageBgLoaded on='complete')
    )
    (block
        (name = 'contentBox')
        (style
            (width = 980px)
            (height = 100%)
            (paddingTop=9px)
            (paddingBottom=30px)
        )
        (bind mouseEnabled "isContentHidden == false")
        (bind mouseChildren "isContentHidden == false")

        (controller $Animation
            (bindcall play to={alpha:0} callbacks="{onComplete:onContentFadeOutComplete}" duration=0.5 easing="Easing.quint_out" (bind enabled "isContentHidden"))
        )
        (bind visible "false" init=false (event "onContentFadeOutComplete")) # WOTD-128820

        (image
            (name = 'CommanderFlag')
            (bind source "nation != '' ? R.images.gui.maps.icons.eventBoards.flagsOverlay[nation]() : ''")
            (style
                (position = "absolute")
                (left = -20px)
                (top = 5%)
            )
        )
        (block
            (style
                (height=33%)
            )
        )
        (block
            (name = 'screenTitle')
            (style
                (width = 100%)
                (align = "center|middle")
            )
            (hblock
                (style
                    (align = "middle")
                )
                (tf
                    (selectable = false)
                    (style
                        (fontFamily = $TitleFont)
                        (fontSize = 36)
                        (textColor = 0xE9E2BF)
                        (letterSpacing = 2)
                        (marginRight = 17)
                    )
                    (bind text "R.strings.store.buyVehicleWindow.title()"
                        (bind enabled "!isRentSelected && !isRestore")
                    )
                    (bind text "R.strings.store.buyVehicleWindow.rent.title()"
                        (bind enabled "isRentSelected")
                    )
                    (bind text "R.strings.store.buyVehicleWindow.title_restore()"
                        (bind enabled "isRestore && !isRentSelected")
                    )
                )
                (element VehicleTitle txt_style='BuyVehicleViewVehicleNameStyle'
                    (scope
                        (bind vehLvlTxt "tankLvl")
                        (bind vehType "tankType")
                        (bind vehNameTxt "tankName")
                        (bind isElite "isElite")
                    )
                    (macro SetSimpleToolTip
                        body="vehicleNameTooltip"
                    )
                )
            )
            (hblock
                (style
                    (height = 16px)
                    (width = 100%)
                    (marginLeft = 50px)
                )
                (style
                    (align = "center")
                    (width = 100%)
                )
                (controller $ToolTip
                    (args
                        tooltipId="'ToolTipTradeInPriceUI'"
                    )
                    (bind enabled "tradeOffVehicleIntCD > 0")
                    (content = "R.views.common.tooltip_window.backport_tooltip_content.BackportTooltipContent.resId")
                    (decorator = "R.views.common.tooltip_window.tooltip_window.TooltipWindow.resId")
                )
            )
        )
        (block
            (style
                (height=21%)
            )
        )
        (block
            (style
                (height = 353)
                (width = 100%)
            )
            (element Group 'commanderLvlCards' 'group' renderer_name='CommanderSlot' container_flow="Flow.HORIZONTAL"
                (scope
                    (containerGap = 31)
                )
            )
        )
        (block
            (style
                (bind height "checkBoxTopMargin > 50 ? 50 : checkBoxTopMargin")
            )
        )
        (hblock
            (style
                (width = 100%)
                (align="right|middle")
            )
            (check_box
                (macro CheckBoxStyleMain "CHECK_BOX_SIZE_MEDIUM")
                (controller $Tutorial viewTutorialId='BuyVehicleView' controlID='commanderCheckbox')
                (scope
                    (dispatch onCheckboxWithoutCrewChanged init=false on='selectedChanged')
                )
                (bind selected "isWithoutCommander")
                (bind label "noCrewCheckboxLabel")
                (name = 'withoutCrewCheckbox')
                (bind visible "hasCommanderCheckbox")
            )
            (tf
                (selectable=false)
                (class MainTextStyle)
                (bind visible "hasCommanderCheckbox")
                (bind text "withoutCommanderAltText")
            )
            (hblock
                (style
                    (width=50%)
                    (align = "right")
                )
                (tf
                    (selectable=false)
                    (class MainTextStyle)
                    (text="R.strings.store.buyVehicleWindow.countCrewLbl()")
                )
                (tf
                    (selectable=false)
                    (class NeutralTextStyle)
                    (bind text "countCrew")
                )
            )
        )
        (block
            (style
                (height=22%)
            )
        )
        (block
            (style
                (align = "bottom")
                (width = 100%)
                (gap = 10px)
            )
            (element BuyVehicleFooter 'equipmentBlock'
                (scope
                    (dispatch onBuyBtnClick on='buyBtnClick' args="{}")
                )
            )
            (mc 'LegalDisclaimerUI'
                (bind visible "needDisclaimer")
                (dispatch onDisclaimerClick args="{}" on='disclaimerClick' dir=1)
            )
        )
        (block
            (style
                (height=11%)
            )
        )
    )

    (text_button 'closeBtn'
        (tabIndex = -1)
        (macro ButtonCloseStyle)
        (style
            (position = "absolute")
            (right = 40px)
            (top = 37px)
        )
        (label = "R.strings.menu.viewHeader.closeBtn.label()")
        (dispatch onCloseBtnClick on='clicked')
    )

    (element CongratulationAnim 'congratulationAnim'
        (scope
            (bind isContentHidden "isContentHidden")
            (bind loadMc "swfLoaded")
        )
    )
)

(def element CongratulationAnim(name:str) layout=true
    (macro VehicleCongratulationModel)
    (scope
        (var initData:dict = null)
        (event onResizeAnim)
        (event onInHangarClick)
        (event onBackClick)
        (var isContentHidden:bool = false)
        (var loadMc:bool = false)

        (bind initData "{
                            isElite: isElite,
                            isCollectible: isCollectible,
                            vehicleType: vehicleType,
                            title: title,
                            lvl: lvl,
                            vName: vName,
                            image: image,
                            imageAlt: imageAlt,
                            btnLbl: btnLbl,
                            backBtnLbl: backBtnLbl,
                            needBackBtn: needBackBtn
                        }")
    )
    (style
        (position = "absolute")
        (bind left "(viewSize.width - $event.width)/2" init=false (event "onResizeAnim"))
        (bind top "(viewSize.height - $event.height)/2" init=false (event "onResizeAnim"))
    )
    (name='CongratulationAnim')
    (view_holder 'animationMc')
    (view_holder_content 'animationMc' "loadMc"
        (mc 'VehicleCongratulationAnimationUI'
            (name = 'vehicleCongratulationAnimation')
            (dispatch onResizeAnim args="{width: $target.width, height:$target.height}" on='resize')
            (dispatch onInHangarClick args="{}" on='inHangar' dir=1)
            (dispatch onBackClick args="{}" on='back' dir=1)
            (bindcall setData "initData" init=true (enabled = "isContentHidden"))
            (bindcall 'dispose' (bind enabled "resetAnimTrigger"))
        )
    )
    (exec "playSound(R.sounds.shop_buy_tank())"
        (bind enabled "isContentHidden")
    )
)
