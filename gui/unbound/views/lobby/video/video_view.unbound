(def layout VideoView() entrance=true hideBeforeResolve=true
    (macro VideoViewModel)
    (style
        (bind width "viewSize.width"
            (event "viewResized")
        )
        (bind height "viewSize.height"
            (event "viewResized")
        )
        (backgroundColor = 0xff000000)
    )

    (scope
        (var videoFinished:bool = false)
        (bind videoFinished "true" init=false
            (event "onVideoStopped")
        )
        (var videoStarted:bool = false)
        (bind videoStarted "true" init=false
            (event "onVideoStarted")
        )  
        (event evDelayComplete)
        (event evMetaDataChanged)
        (var showGuiDelay:number = 0)
        (bind showGuiDelay "$event.duration-0.001-0.5" init=false (event "evMetaDataChanged"))
        
        (var guiVisible:number = 0)
        (controller $Animation
            (bindcall play delay="videoFinished? 0: showGuiDelay" duration="0.3" to={guiVisible:1} init=false
                (enabled = "videoFinished? videoFinished:showGuiDelay > 0")
                (event "onVideoStarted")
            )
        )

        (var videoAlpha:number = 0)
        (controller $Animation
            (bindcall play duration=0.7 to={videoAlpha:1} callbacks="{onComplete: evDelayComplete}" init=true)
        )
    )

    (dispatch onCloseBtnClick on='escPressed'
        (enabled = "videoFinished")
    )

    (block
        (name = 'Video')
        (style 
            (width = 100%)
            (height = 100%)
            (align = "center|middle")
            (bind alpha "videoAlpha")
        )

        (element VideoComponent
            (name = 'specialVideo')
            (scope
                (canEscape = true)
                (canClick = false)
                (isVideoPlaying = false)
                (seekToEnd = true)
                (bind isVideoPlaying "true" init=false
                    (event "evDelayComplete")
                )
                (bind subtitleTrack "subtitleTrack")
                (bind isVideoPaused "!isWindowAccessible")
                (bind sourceName "videoSource" init=false)
                (dispatch onVideoStarted on='evOnPlaybackStarted')
                (dispatch onVideoStopped on='evOnPlaybackStopped')
            )
        )
    )

    (controller $Instance renderer = 'VignetteBlock' layout="true"
        (bind enabled "isVignetteVisible")
    )

    (controller $Instance layout="true"
        (exprs
            (name = 'UILayer')
            (style
                (position = "absolute")
                (width  = 100%)
                (height = 100%)
            )
            (bind visible "guiVisible != 0")

            (text_button 'closeBtn'
                (macro ButtonCloseStyle)
                (style
                    (position = "absolute")
                    (right = 50px)
                    (top = 49px)
                )
                (label = "R.strings.menu.viewHeader.closeBtn.label()")
                (dispatch onCloseBtnClick on='click')
                (tabIndex = 3)
            )
        )
        (bind enabled "isUIVisible")
    )
)
